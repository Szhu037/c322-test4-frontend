<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="navbar.css">
    <link rel="stylesheet" href="cards.css">
    <style>
      .button {
        background-color: #04AA6D;
        border: none;
        color: white;
        padding: 15px 32px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        margin: 4px 2px;
        cursor: pointer;
      }
    </style>
  </head>

  <body>
    <table width="70%">
      <tr>
        <td>
          <ul class="topnav">
            <li><a href="index.html"><img src="http://127.0.0.1:5500/images/final-project.png"/></a></li>
            <li class="right"><a href=""><img id="cart" src="" width="30px"/></a></li>
            <li class="right"><a href="login.html">Login</a></li>
            <li class="right"><a href="">Help</a></li>
            <li class="right"><a href="traceorder.html">Track Order</a></li>
          </ul>
       </td>
      </tr>
    </table>

    <table width="70%">
        <tr>
          <td align="center">
            <img id="reviewImg" src="http://127.0.0.1:5500/images/review.png"/><br>
            <div id="infoDiv" class="box"><font color="white">Save $10 on every delivery with an account</font></div><br>
            <button id="loginButton" type="button" class="button" onclick="login()">LOG IN</button>  <button id="signUpButton" type="button" class="button" onclick="signUp()">SIGN UP</button>
         </td>
        </tr>
        <tr>
          <td id="flowerInfo"></td>
        </tr>
        <tr>
          <td><img id="image" src="" height="200" align="left"/><br>
          </td>
        </tr>
        <tr>
          <td><h3>Delivery Date:</h3> <h3 id="deliveryDate"></h3></td>
        </tr>
        <tr>
          <td><h1>RECIPIENT</h1></td>
        </tr>
        <tr>
          <td> 
            <label for="fname">First Name*</label>
            <input type="text" id="fname" name="fname"  size="30">
            <label for="lname">Last Name*</label>
            <input type="text" id="lname" name="lname"  size="30"><br>
            <p></p>
            <label for="relationship">Relationship*</label>
            <select name="relationship" id="relationship" >
              <option value="mother">Mother</option>
              <option value="father">Father</option>
              <option value="sibling">sibling</option>
              <option value="friend">friend</option>
            </select>
          </td>
        </tr>
        <tr>
          <td><h1>DELIVER TO</h1></td>
        </tr>
        <tr>
          <td> 
            <label for="address">Address*</label>
            <input type="text" id="address" name="address" size="60"> We can't ship to PO Boxes.<br>
            <p></p>
            <label for="suite">APT/SUITE*</label>
            <input type="text" id="suite" name="suite" size="30">
            <label for="city">City*</label>
            <input type="text" id="city" name="city" size="30"><br>
            <p></p>
            <label for="state">State*</label>
            <input type="text" id="state" name="state" size="30">
            <label for="zipcode">Zip Code*</label>
            <input type="text" id="zipcode" name="zipcode" size="30">
          </td>
        </tr>
        <tr>
          <td>
            <p></p>
            <p></p>
            <p></p>
            <buttom type="button" class="button" onclick="continueNext();">CONTINUE</buttom> Taxes and delivery calculated later.
          </td>
        </tr>
      </table>
    <script>
       let host = "http://localhost:8080";
       let flowerId = localStorage.getItem("flowerId");
       loadFlower(flowerId);
       

       if(getCookie("jwtToken") == null) {
          document.getElementById('loginButton').style.visibility = 'visible';
          document.getElementById('signUpButton').style.visibility = 'visible';
          document.getElementById('reviewImg').style.visibility = 'visible';
          document.getElementById('infoDiv').style.visibility = 'visible';
       } else {
          document.getElementById('loginButton').style.visibility = 'hidden';
          document.getElementById('signUpButton').style.visibility = 'hidden';
          document.getElementById('reviewImg').style.visibility = 'hidden';
          document.getElementById('infoDiv').style.visibility = 'hidden';
       }
       function login(){
         location.href="login.html";
       }
       function signUp(){
         location.href="login.html?signup=true";
       }
       function getCookie(name) {
        function escape(s) { return s.replace(/([.*+?\^$(){}|\[\]\/\\])/g, '\\$1'); }
        var match = document.cookie.match(RegExp('(?:^|;\\s*)' + escape(name) + '=([^;]*)'));
        return match ? match[1] : null;
      }

      async function loadFlower(flowerId){
        if(flowerId == null){
           document.getElementById("cart").src = "http://localhost:5500/images/cart0.jpg";
        } else {
          document.getElementById("cart").src = "http://localhost:5500/images/cart1.jpg";
        }
        let response = await fetch(host + "/flowers/"+flowerId);
        let flower = await response.json();
        document.getElementById("flowerInfo").innerHTML = "<hr><table width='100%'><tr><td align='left'><h2>" + flower.name + "</h2></td><td align='right'><h2>$" + flower.price+"</h2></td></tr></table><hr>";
        document.getElementById("image").setAttribute("src","http://127.0.0.1:5500/images/"+flower.icon_file_name);
        document.getElementById("deliveryDate").innerHTML = localStorage.getItem("deliveryDate");
      }
      function continueNext(){
        let firstName = document.getElementById("fname").value;
        let lastName = document.getElementById("lname").value;
        let relationship = document.getElementById("relationship").value;
        let address = document.getElementById("address").value;
        let suite = document.getElementById("suite").value;
        let city = document.getElementById("city").value;
        let state = document.getElementById("state").value;
        let zipcode = document.getElementById("zipcode").value;
  

        if(firstName.length === 0 || lastName.length === 0 || relationship.length === 0 
          || address.length === 0 || suite.length === 0 || city.length === 0 || state.length === 0 || zipcode.length === 0 ){
            alert("All fields are required!");
            return false;
          }


        localStorage.setItem("firstName", firstName);
        localStorage.setItem("lastName", lastName);
        localStorage.setItem("relationship",relationship);
        localStorage.setItem("address",address);
        localStorage.setItem("suite",suite);
        localStorage.setItem("city",city);
        localStorage.setItem("state",state);
        localStorage.setItem("zipcode",zipcode);

        location.href="placeorder.html";
      }
    </script>
  </body>
</html>
